/* ============================================================
   LessonForge — Design System
   Aesthetic: Academic Observatory
   ============================================================ */

/* --- Reset --- */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

/* --- Tokens --- */
:root{
  /* Palette */
  --bg:#F6F5F0;
  --surface:#FFFFFF;
  --surface-dim:#EFEDE7;
  --surface-bright:#FAFAF7;
  --ink:#2B2E33;
  --ink-secondary:#5A5E66;
  --ink-muted:#94979E;
  --ink-faint:#C0C2C7;

  --primary:#4A6FA5;
  --primary-hover:#3B5C8C;
  --primary-subtle:#E6EDF6;
  --primary-ghost:rgba(74,111,165,.08);

  --accent:#B8893C;
  --accent-subtle:#FBF5E8;

  --success:#3D8B6E;
  --success-subtle:#E9F5EF;
  --warning:#C48A2C;
  --warning-subtle:#FDF5E6;
  --error:#B8504A;
  --error-subtle:#FBEEED;

  --border:#E4E2DC;
  --border-light:#EEECE7;

  /* Shadows */
  --sh-xs:0 1px 2px rgba(0,0,0,.04);
  --sh-sm:0 2px 6px rgba(0,0,0,.05);
  --sh-md:0 4px 16px rgba(0,0,0,.06),0 1px 3px rgba(0,0,0,.04);
  --sh-lg:0 12px 40px rgba(0,0,0,.08),0 2px 8px rgba(0,0,0,.03);
  --sh-xl:0 24px 64px rgba(0,0,0,.10),0 4px 12px rgba(0,0,0,.04);

  /* Radii */
  --r-sm:6px;
  --r-md:10px;
  --r-lg:14px;
  --r-xl:20px;

  /* Type */
  --font-display:'Instrument Serif',Georgia,serif;
  --font-body:'Plus Jakarta Sans',-apple-system,BlinkMacSystemFont,sans-serif;
  --font-mono:'JetBrains Mono','Fira Code',monospace;
}

/* --- Base --- */
html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{font-family:var(--font-body);background:var(--bg);color:var(--ink);line-height:1.6;min-height:100vh;overflow-x:hidden}
::selection{background:var(--primary-subtle);color:var(--primary-hover)}

/* --- Views --- */
.view{display:none}
.view.active{display:flex;flex-direction:column;animation:viewIn .4s ease both}
#generate-view.active{height:100vh;overflow:hidden}
@keyframes viewIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* ============================================================
   COMPOSE VIEW
   ============================================================ */
.compose-nav{
  padding:20px 32px;
  display:flex;align-items:center;
}
.brand{display:flex;align-items:center;gap:8px}
.brand-mark{
  font-size:1.25rem;color:var(--primary);
  display:inline-flex;align-items:center;justify-content:center;
  width:32px;height:32px;
  background:var(--primary-subtle);
  border-radius:var(--r-sm);
}
.brand-name{
  font-family:var(--font-display);
  font-size:1.15rem;
  color:var(--ink);
  letter-spacing:-.01em;
}

.compose-stage{
  flex:1;
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;
  padding:0 24px 60px;
  min-height:calc(100vh - 72px);
}
.hero-heading{
  font-family:var(--font-display);
  font-size:clamp(2rem,4.5vw,3rem);
  line-height:1.15;
  text-align:center;
  color:var(--ink);
  letter-spacing:-.02em;
  margin-bottom:14px;
}
.hero-sub{
  text-align:center;
  color:var(--ink-secondary);
  font-size:.95rem;
  line-height:1.6;
  max-width:520px;
  margin-bottom:36px;
}

/* Input Card */
.input-card{
  width:100%;max-width:640px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--r-xl);
  padding:6px;
  box-shadow:var(--sh-md);
  transition:box-shadow .25s,border-color .25s;
}
.input-card:focus-within{
  border-color:var(--primary);
  box-shadow:var(--sh-lg),0 0 0 3px var(--primary-ghost);
}
.input-card textarea{
  width:100%;border:none;outline:none;
  resize:none;
  padding:18px 20px;
  font-family:var(--font-body);
  font-size:.95rem;
  color:var(--ink);
  background:transparent;
  line-height:1.55;
  border-radius:var(--r-lg);
}
.input-card textarea::placeholder{color:var(--ink-faint)}

/* Context area (hidden by default) */
.context-area{
  max-height:0;overflow:hidden;opacity:0;
  transition:max-height .3s ease,opacity .25s ease,padding .3s ease;
  padding:0 4px;
}
.context-area.open{
  max-height:200px;opacity:1;
  padding:0 4px 4px;
}
.context-area textarea{
  width:100%;border:1px dashed var(--border);
  border-radius:var(--r-md);
  outline:none;resize:none;
  padding:12px 16px;
  font-family:var(--font-body);font-size:.875rem;
  color:var(--ink-secondary);
  background:var(--surface-bright);
  line-height:1.5;
  transition:border-color .2s;
}
.context-area textarea:focus{border-color:var(--primary)}
.context-area textarea::placeholder{color:var(--ink-faint)}

/* Generate Button */
.generate-btn{
  display:flex;align-items:center;justify-content:center;gap:8px;
  width:100%;
  padding:14px 24px;
  margin-top:2px;
  background:var(--primary);color:#fff;
  border:none;border-radius:0 0 calc(var(--r-xl) - 4px) calc(var(--r-xl) - 4px);
  font-family:var(--font-body);font-size:.925rem;font-weight:600;
  cursor:pointer;
  transition:background .2s,transform .1s,opacity .2s;
}
.generate-btn:hover:not(:disabled){background:var(--primary-hover);transform:translateY(-1px)}
.generate-btn:active:not(:disabled){transform:translateY(0)}
.generate-btn:disabled{opacity:.5;cursor:not-allowed}
.generate-btn.loading .btn-label{opacity:0}
.generate-btn.loading .btn-arrow{display:none}
.generate-btn.loading .btn-spinner{display:block}
.btn-spinner{
  display:none;
  width:18px;height:18px;
  border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin .6s linear infinite;
  position:absolute;
}
@keyframes spin{to{transform:rotate(360deg)}}
.btn-arrow{transition:transform .2s}
.generate-btn:hover:not(:disabled) .btn-arrow{transform:translateX(3px)}

/* Config Chips */
.config-row{
  display:flex;flex-wrap:wrap;justify-content:center;
  gap:8px;
  margin-top:20px;
  max-width:640px;
}
.chip{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:100px;
  font-family:var(--font-body);font-size:.8rem;
  color:var(--ink-secondary);
  cursor:pointer;
  transition:all .2s;
  white-space:nowrap;
}
.chip:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-subtle)}
.chip-icon{display:inline-flex;align-items:center;opacity:.6}
.chip:hover .chip-icon{opacity:1}
.chip-caret{
  font-size:.75rem;
  transform:rotate(-90deg);
  opacity:.4;
  transition:transform .2s;
}
.chip:hover .chip-caret{opacity:.7}
.chip-toggle{border-style:dashed}
.chip-toggle.active{border-style:solid;border-color:var(--primary);color:var(--primary);background:var(--primary-subtle)}
.chip-plus{font-weight:600;opacity:.5}
.chip-toggle.active .chip-plus::after{content:'\2013';font-weight:400}
.chip-toggle.active .chip-plus{opacity:.8}

/* History Section */
.history-section{
  width:100%;max-width:640px;
  margin-top:40px;
  animation:fadeUp .5s ease .2s both;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.history-section.empty{display:none}

.history-header{
  display:flex;align-items:center;gap:12px;
  margin-bottom:14px;
}
.history-label{
  font-size:.72rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.06em;
  color:var(--ink-faint);
  white-space:nowrap;
}
.history-line{flex:1;height:1px;background:var(--border-light)}
.history-clear-all{
  font-family:var(--font-body);font-size:.68rem;font-weight:500;
  color:var(--ink-faint);
  background:none;border:1px solid var(--border-light);border-radius:100px;
  padding:3px 10px;cursor:pointer;
  transition:all .15s;white-space:nowrap;
}
.history-clear-all:hover{color:var(--error);border-color:var(--error)}

.history-grid{
  display:flex;flex-direction:column;gap:6px;
}
.history-card{
  display:flex;align-items:center;gap:14px;
  padding:12px 16px;
  background:var(--surface);
  border:1px solid var(--border-light);
  border-radius:var(--r-md);
  cursor:pointer;
  transition:all .15s;
  text-align:left;
  width:100%;
  font-family:var(--font-body);
}
.history-card:hover{
  border-color:var(--primary);
  box-shadow:var(--sh-sm);
  transform:translateY(-1px);
}
.history-dot{
  width:8px;height:8px;flex-shrink:0;
  border-radius:50%;
  background:var(--success);
}
.history-dot.error{background:var(--error)}
.history-dot.running{background:var(--primary);animation:dotPulse 2s ease-in-out infinite}

.history-info{flex:1;min-width:0}
.history-topic{
  font-size:.85rem;font-weight:500;
  color:var(--ink);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.history-meta{
  font-size:.72rem;color:var(--ink-muted);
  margin-top:2px;
  display:flex;gap:8px;flex-wrap:wrap;
}
.history-meta span{white-space:nowrap}

.history-time{
  font-size:.7rem;color:var(--ink-faint);
  white-space:nowrap;flex-shrink:0;
}
.history-delete{
  width:26px;height:26px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  background:none;border:1px solid transparent;border-radius:var(--r-sm);
  color:var(--ink-faint);font-size:.85rem;
  cursor:pointer;transition:all .15s;
  opacity:0;
  font-family:var(--font-body);
}
.history-card:hover .history-delete{opacity:1}
.history-delete:hover{color:var(--error);border-color:var(--error-subtle);background:var(--error-subtle)}

.history-arrow{
  color:var(--ink-faint);font-size:.9rem;
  opacity:0;transition:opacity .15s;
}
.history-card:hover .history-arrow{opacity:1}

/* Confirmation Dialog */
.confirm-overlay{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:rgba(30,28,24,.35);
  backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);
  z-index:950;
  opacity:0;pointer-events:none;
  transition:opacity .2s;
}
.confirm-overlay.open{opacity:1;pointer-events:auto}
.confirm-box{
  background:var(--surface);
  border-radius:var(--r-lg);
  box-shadow:var(--sh-xl);
  padding:28px 32px 24px;
  max-width:360px;width:90%;
  text-align:center;
  transform:translateY(8px) scale(.97);
  transition:transform .2s ease;
}
.confirm-overlay.open .confirm-box{transform:translateY(0) scale(1)}
.confirm-msg{font-size:.95rem;font-weight:600;color:var(--ink);margin-bottom:4px}
.confirm-sub{font-size:.82rem;color:var(--ink-muted);margin-bottom:20px}
.confirm-actions{display:flex;gap:8px;justify-content:center}
.btn-danger{
  padding:8px 20px;
  background:var(--error);color:#fff;
  border:none;border-radius:var(--r-sm);
  font-family:var(--font-body);font-size:.85rem;font-weight:600;
  cursor:pointer;transition:background .15s;
}
.btn-danger:hover{background:#a34440}

/* ============================================================
   GENERATE VIEW
   ============================================================ */
.gen-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 20px;
  background:var(--surface);
  border-bottom:1px solid var(--border);
  gap:16px;
  flex-shrink:0;
}
.gen-header-left{display:flex;align-items:center;gap:12px;min-width:0}

.back-btn{
  display:inline-flex;align-items:center;gap:5px;
  padding:6px 12px;
  background:none;border:1px solid var(--border);border-radius:var(--r-sm);
  font-family:var(--font-body);font-size:.8rem;
  color:var(--ink-secondary);cursor:pointer;
  transition:all .15s;
  flex-shrink:0;
}
.back-btn:hover{border-color:var(--ink-muted);color:var(--ink)}
.back-arrow{font-size:1rem;line-height:1}

.gen-topic-pill{
  font-size:.8rem;color:var(--ink-muted);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  max-width:280px;
}

/* Export Button */
.export-btn{
  display:inline-flex;align-items:center;justify-content:center;
  width:32px;height:32px;flex-shrink:0;
  background:none;border:1px solid var(--border);border-radius:var(--r-sm);
  color:var(--ink-secondary);cursor:pointer;
  transition:all .15s;
}
.export-btn:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-ghost)}

/* Step Rail */
.step-rail{
  display:flex;align-items:center;gap:0;
  flex-shrink:0;
}
.rail-node{
  width:26px;height:26px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.65rem;font-weight:700;
  color:var(--ink-faint);
  background:var(--surface-dim);
  border:2px solid var(--border-light);
  transition:all .3s;
  position:relative;
}
.rail-node[data-status="active"]{
  color:#fff;background:var(--primary);border-color:var(--primary);
  box-shadow:0 0 0 3px var(--primary-ghost);
  animation:nodePulse 2s ease-in-out infinite;
}
.rail-node[data-status="completed"]{
  color:#fff;background:var(--success);border-color:var(--success);
}
.rail-node[data-status="completed"]::after{
  content:'\2713';font-size:.7rem;
}
.rail-node[data-status="completed"] .rail-num{display:none}
.rail-edge{
  width:20px;height:2px;
  background:var(--border-light);
  transition:background .3s;
}
.rail-edge.done{background:var(--success)}
@keyframes nodePulse{0%,100%{box-shadow:0 0 0 3px var(--primary-ghost)}50%{box-shadow:0 0 0 6px rgba(74,111,165,.06)}}

/* Gen Body — both children scroll independently */
.gen-body{
  display:flex;
  flex:1;
  min-height:0;
  height:calc(100vh - 54px);
  overflow:hidden;
}

/* Output Pane — scrolls vertically */
.output-pane{
  flex:1.4;
  overflow-y:auto;
  padding:32px 40px 48px;
  background:var(--surface);
  border-right:1px solid var(--border-light);
  height:100%;
}
.output-empty{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:260px;
  color:var(--ink-muted);font-size:.9rem;
  gap:16px;
}
.output-empty.hidden{display:none}
.empty-pulse{
  width:40px;height:40px;
  border-radius:50%;
  background:var(--primary-subtle);
  animation:emptyPulse 2s ease-in-out infinite;
}
@keyframes emptyPulse{0%,100%{transform:scale(1);opacity:.6}50%{transform:scale(1.15);opacity:1}}

/* Markdown Body */
.markdown-body{display:none;line-height:1.72}
.markdown-body.visible{display:block}
.markdown-body.streaming::after{
  content:'\258A';
  color:var(--primary);
  animation:cursorBlink .8s steps(2) infinite;
  margin-left:1px;
}
@keyframes cursorBlink{0%,100%{opacity:1}50%{opacity:0}}

.markdown-body h1{
  font-family:var(--font-display);font-size:1.6rem;
  color:var(--ink);margin:0 0 16px;
  padding-bottom:10px;border-bottom:2px solid var(--primary-subtle);
  line-height:1.25;
}
.markdown-body h2{
  font-family:var(--font-display);font-size:1.3rem;
  color:var(--primary-hover);margin:28px 0 10px;
  line-height:1.3;
}
.markdown-body h3{
  font-size:1.05rem;font-weight:700;
  color:var(--ink);margin:22px 0 8px;
}
.markdown-body h4{font-size:.95rem;font-weight:600;margin:18px 0 6px;color:var(--ink-secondary)}
.markdown-body p{margin:8px 0;color:var(--ink)}
.markdown-body ul,.markdown-body ol{margin:10px 0 10px 22px}
.markdown-body li{margin:4px 0}
.markdown-body li::marker{color:var(--primary)}
.markdown-body strong{color:var(--ink);font-weight:600}
.markdown-body em{font-style:italic;color:var(--ink-secondary)}
.markdown-body blockquote{
  margin:14px 0;padding:12px 18px;
  border-left:3px solid var(--primary);
  background:var(--primary-subtle);
  border-radius:0 var(--r-sm) var(--r-sm) 0;
  color:var(--ink-secondary);font-size:.92rem;
}
.markdown-body code{
  font-family:var(--font-mono);font-size:.85em;
  background:var(--surface-dim);
  padding:2px 6px;border-radius:4px;
}
.markdown-body pre{
  background:var(--surface-dim);border:1px solid var(--border-light);
  border-radius:var(--r-md);padding:16px;
  overflow-x:auto;margin:12px 0;
  font-size:.82rem;line-height:1.6;
}
.markdown-body pre code{background:none;padding:0}
.markdown-body table{
  width:100%;border-collapse:collapse;
  margin:14px 0;font-size:.88rem;
}
.markdown-body th,.markdown-body td{
  border:1px solid var(--border);
  padding:8px 12px;text-align:left;
}
.markdown-body th{background:var(--surface-dim);font-weight:600;font-size:.82rem;color:var(--ink-secondary)}
.markdown-body hr{border:none;border-top:1px solid var(--border-light);margin:24px 0}

/* Inspector Pane — stays in view, scrolls independently */
.inspector-pane{
  flex:1;
  overflow-y:auto;
  background:var(--surface-bright);
  padding:20px;
  display:flex;flex-direction:column;gap:16px;
  min-width:320px;max-width:460px;
  height:100%;
}
.inspector-title{
  display:flex;align-items:center;gap:7px;
  font-size:.78rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.06em;
  color:var(--ink-muted);
  padding-bottom:8px;
  border-bottom:1px solid var(--border-light);
}
.inspector-title svg{opacity:.5}

/* Inspector Steps */
.inspector-steps{display:flex;flex-direction:column;gap:2px}

.istep{
  border-radius:var(--r-md);
  background:var(--surface);
  border:1px solid var(--border-light);
  overflow:hidden;
  transition:border-color .2s,box-shadow .2s;
}
.istep[data-status="active"]{border-color:var(--primary);box-shadow:0 0 0 2px var(--primary-ghost)}
.istep[data-status="completed"]{border-color:var(--success-subtle)}

.istep-head{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;
  cursor:pointer;
  user-select:none;
  transition:background .15s;
}
.istep-head:hover{background:var(--surface-dim)}

.istep-dot{
  width:20px;height:20px;flex-shrink:0;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.6rem;font-weight:700;
  color:var(--ink-faint);
  background:var(--surface-dim);
  border:2px solid var(--border);
  transition:all .3s;
}
.istep[data-status="active"] .istep-dot{
  color:#fff;background:var(--primary);border-color:var(--primary);
  animation:dotPulse 2s ease-in-out infinite;
}
.istep[data-status="completed"] .istep-dot{
  color:#fff;background:var(--success);border-color:var(--success);
  font-size:.65rem;
}
@keyframes dotPulse{0%,100%{box-shadow:0 0 0 0 rgba(74,111,165,.15)}50%{box-shadow:0 0 0 4px rgba(74,111,165,.08)}}

.istep-label{
  flex:1;font-size:.82rem;font-weight:500;
  color:var(--ink-secondary);
  transition:color .2s;
}
.istep[data-status="active"] .istep-label{color:var(--primary);font-weight:600}
.istep[data-status="completed"] .istep-label{color:var(--success)}

.istep-time{
  font-family:var(--font-mono);font-size:.7rem;
  color:var(--ink-muted);min-width:40px;text-align:right;
}

.istep-chevron{
  font-size:.7rem;color:var(--ink-faint);
  transition:transform .2s;
}
.istep.open .istep-chevron{transform:rotate(90deg)}

/* Step Body (collapsed by default) */
.istep-body{
  max-height:0;overflow:hidden;
  transition:max-height .3s ease;
}
.istep.open .istep-body{max-height:600px}

.istep-data{
  padding:0 14px 12px;
  font-size:.78rem;color:var(--ink-secondary);
}
.istep-data table{
  width:100%;border-collapse:collapse;margin-top:6px;
}
.istep-data th,.istep-data td{
  padding:5px 8px;text-align:left;
  border-bottom:1px solid var(--border-light);
  font-size:.75rem;
}
.istep-data th{color:var(--ink-muted);font-weight:500;font-size:.7rem;text-transform:uppercase;letter-spacing:.04em}

.kv-row{display:flex;gap:8px;margin:3px 0}
.kv-key{
  font-size:.72rem;font-weight:500;
  color:var(--ink-muted);
  min-width:72px;text-align:right;
  font-family:var(--font-mono);
}
.kv-val{font-size:.78rem;color:var(--ink)}

.conf-badge{
  display:inline-block;padding:1px 7px;
  border-radius:100px;font-size:.65rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.03em;
}
.conf-high{background:var(--success-subtle);color:var(--success)}
.conf-medium{background:var(--warning-subtle);color:var(--warning)}
.conf-low{background:var(--error-subtle);color:var(--error)}

/* Prompt Viewer (accordion in inspector) */
.inspector-prompt:empty{display:none}
.inspector-prompt{
  border:1px solid var(--border-light);
  border-radius:var(--r-md);
  background:var(--surface);
  overflow:hidden;
}
.prompt-header{
  display:flex;align-items:center;gap:8px;
  padding:10px 14px;
  cursor:pointer;user-select:none;
  transition:background .15s;
}
.prompt-header:hover{background:var(--surface-dim)}
.prompt-header-label{
  flex:1;font-size:.78rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.05em;
  color:var(--ink-muted);
}
.prompt-header-icon{
  font-size:.7rem;color:var(--ink-faint);
  transition:transform .2s;
}
.inspector-prompt.open .prompt-header-icon{transform:rotate(90deg)}
.prompt-copy{
  display:inline-flex;align-items:center;gap:4px;
  padding:2px 8px;
  background:none;border:1px solid var(--border-light);border-radius:var(--r-sm);
  font-family:var(--font-body);font-size:.65rem;font-weight:500;
  color:var(--ink-muted);cursor:pointer;
  transition:all .15s;
}
.prompt-copy:hover{border-color:var(--primary);color:var(--primary)}
.prompt-body{
  max-height:0;overflow:hidden;
  transition:max-height .3s ease;
}
.inspector-prompt.open .prompt-body{max-height:500px}
.prompt-text{
  margin:0;padding:12px 14px;
  font-family:var(--font-mono);font-size:.75rem;
  line-height:1.55;color:var(--ink-secondary);
  background:var(--surface-bright);
  border-top:1px solid var(--border-light);
  max-height:400px;overflow-y:auto;
  white-space:pre-wrap;word-break:break-word;
}

/* Token Usage (inspector section) */
.inspector-tokens:empty{display:none}
.inspector-tokens{
  border:1px solid var(--border-light);
  border-radius:var(--r-md);
  background:var(--surface);
  overflow:hidden;
}
.tokens-header{
  display:flex;align-items:center;gap:8px;
  padding:10px 14px;
  cursor:pointer;user-select:none;
  transition:background .15s;
}
.tokens-header:hover{background:var(--surface-dim)}
.tokens-header-label{
  flex:1;font-size:.78rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.05em;
  color:var(--ink-muted);
}
.tokens-header-icon{
  font-size:.7rem;color:var(--ink-faint);
  transition:transform .2s;
}
.inspector-tokens.open .tokens-header-icon{transform:rotate(90deg)}
.tokens-total-badge{
  display:inline-block;padding:1px 8px;
  border-radius:100px;font-family:var(--font-mono);font-size:.68rem;font-weight:600;
  background:var(--primary-subtle);color:var(--primary);
}
.tokens-body{
  max-height:0;overflow:hidden;
  transition:max-height .3s ease;
}
.inspector-tokens.open .tokens-body{max-height:400px}
.tokens-content{
  padding:10px 14px;
  border-top:1px solid var(--border-light);
}
.token-step{margin-bottom:10px}
.token-step:last-child{margin-bottom:0}
.token-step-name{
  font-size:.72rem;font-weight:600;
  color:var(--ink-secondary);
  margin-bottom:4px;
  display:flex;align-items:center;gap:6px;
}
.token-step-model{
  font-family:var(--font-mono);font-size:.65rem;font-weight:400;
  color:var(--ink-muted);
}
.token-bar{
  display:flex;gap:2px;height:8px;border-radius:4px;overflow:hidden;
  background:var(--surface-dim);margin-bottom:4px;
}
.token-bar-in{background:var(--primary);border-radius:4px 0 0 4px;transition:width .4s ease}
.token-bar-out{background:var(--accent);border-radius:0 4px 4px 0;transition:width .4s ease}
.token-counts{
  display:flex;gap:12px;
  font-family:var(--font-mono);font-size:.68rem;color:var(--ink-muted);
}
.token-count-in::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--primary);margin-right:4px;vertical-align:middle}
.token-count-out::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--accent);margin-right:4px;vertical-align:middle}

/* Inspector Timings */
.inspector-timings{
  margin-top:auto;
  padding-top:14px;
  border-top:1px solid var(--border-light);
}
.inspector-timings:empty{display:none}
.timings-title{
  font-size:.72rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.05em;
  color:var(--ink-muted);
  margin-bottom:10px;
}
.timing-row{display:flex;align-items:center;gap:8px;margin:5px 0}
.timing-label{
  width:110px;text-align:right;
  font-size:.72rem;font-weight:500;color:var(--ink-muted);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.timing-track{flex:1;height:6px;background:var(--surface-dim);border-radius:3px;overflow:hidden}
.timing-fill{height:100%;background:var(--primary);border-radius:3px;transition:width .4s ease}
.timing-val{
  width:42px;text-align:right;
  font-family:var(--font-mono);font-size:.68rem;color:var(--ink-muted);
}

/* ============================================================
   MODALS
   ============================================================ */
.modal-backdrop{
  position:fixed;inset:0;
  background:rgba(30,28,24,.35);
  backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);
  z-index:900;
  opacity:0;pointer-events:none;
  transition:opacity .25s;
}
.modal-backdrop.open{opacity:1;pointer-events:auto}

.modal{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  z-index:910;
  opacity:0;pointer-events:none;
  transition:opacity .2s;
}
.modal.open{opacity:1;pointer-events:auto}

.modal-box{
  background:var(--surface);
  border-radius:var(--r-xl);
  box-shadow:var(--sh-xl);
  width:90%;max-width:480px;
  max-height:85vh;
  display:flex;flex-direction:column;
  transform:translateY(12px) scale(.98);
  transition:transform .25s ease;
}
.modal.open .modal-box{transform:translateY(0) scale(1)}

.modal-wide .modal-box,.modal-box.modal-wide{max-width:600px}

.modal-head{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 24px 0;
}
.modal-head h2{
  font-family:var(--font-display);
  font-size:1.2rem;color:var(--ink);
}
.modal-x{
  width:30px;height:30px;
  display:flex;align-items:center;justify-content:center;
  background:none;border:none;
  font-size:1.3rem;color:var(--ink-muted);
  cursor:pointer;border-radius:var(--r-sm);
  transition:background .15s,color .15s;
}
.modal-x:hover{background:var(--surface-dim);color:var(--ink)}

.modal-content{
  padding:20px 24px;
  overflow-y:auto;flex:1;
}

.modal-columns{
  display:flex;gap:0;
}
.modal-col{flex:1;padding-right:16px}
.modal-col:last-child{padding-right:0;padding-left:16px}
.modal-divider{width:1px;background:var(--border-light);flex-shrink:0}
.modal-col-title{
  font-size:.72rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.06em;
  color:var(--ink-muted);margin-bottom:12px;
}

.modal-foot{
  display:flex;justify-content:flex-end;gap:8px;
  padding:16px 24px 20px;
  border-top:1px solid var(--border-light);
}

/* Option List (radios in modals) */
.option-list{display:flex;flex-direction:column;gap:2px}
.option-group-label{
  font-size:.68rem;font-weight:600;
  text-transform:uppercase;letter-spacing:.05em;
  color:var(--ink-faint);
  padding:10px 0 4px;
}
.option-group-label:first-child{padding-top:0}
.option-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 12px;
  border-radius:var(--r-sm);
  cursor:pointer;
  transition:background .12s;
  font-size:.85rem;color:var(--ink-secondary);
}
.option-item:hover{background:var(--surface-dim)}
.option-item.selected{background:var(--primary-subtle);color:var(--primary);font-weight:500}
.option-radio{
  width:16px;height:16px;flex-shrink:0;
  border-radius:50%;
  border:2px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.option-item.selected .option-radio{border-color:var(--primary)}
.option-item.selected .option-radio::after{
  content:'';width:8px;height:8px;
  border-radius:50%;background:var(--primary);
}

/* Card Grid (teaching focus & resource type) */
.card-grid{display:flex;flex-direction:column;gap:6px}
.card-option{
  display:flex;align-items:flex-start;gap:12px;
  padding:14px 16px;
  border:1px solid var(--border-light);
  border-radius:var(--r-md);
  cursor:pointer;
  transition:all .15s;
}
.card-option:hover{border-color:var(--primary);background:var(--primary-ghost)}
.card-option.selected{
  border-color:var(--primary);
  background:var(--primary-subtle);
  box-shadow:0 0 0 2px var(--primary-ghost);
}
.card-radio{
  width:18px;height:18px;flex-shrink:0;margin-top:1px;
  border-radius:50%;
  border:2px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.card-option.selected .card-radio{border-color:var(--primary)}
.card-option.selected .card-radio::after{
  content:'';width:10px;height:10px;
  border-radius:50%;background:var(--primary);
}
.card-info{flex:1;min-width:0}
.card-name{font-size:.88rem;font-weight:600;color:var(--ink);margin-bottom:2px}
.card-desc{font-size:.78rem;color:var(--ink-muted);line-height:1.45}
.card-option.selected .card-name{color:var(--primary)}

/* Buttons */
.btn-solid{
  padding:8px 20px;
  background:var(--primary);color:#fff;
  border:none;border-radius:var(--r-sm);
  font-family:var(--font-body);font-size:.85rem;font-weight:600;
  cursor:pointer;transition:background .15s;
}
.btn-solid:hover{background:var(--primary-hover)}
.btn-ghost{
  padding:8px 16px;
  background:none;color:var(--ink-secondary);
  border:1px solid var(--border);border-radius:var(--r-sm);
  font-family:var(--font-body);font-size:.85rem;font-weight:500;
  cursor:pointer;transition:all .15s;
}
.btn-ghost:hover{border-color:var(--ink-muted);color:var(--ink)}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media(max-width:900px){
  .gen-body{flex-direction:column}
  .inspector-pane{max-width:none;border-top:1px solid var(--border-light)}
  .output-pane{border-right:none;min-height:50vh}
  .modal-columns{flex-direction:column}
  .modal-divider{width:100%;height:1px;margin:12px 0}
  .modal-col{padding:0 !important}
  .step-rail{display:none}
  .gen-topic-pill{max-width:180px}
}

@media(max-width:600px){
  .compose-stage{padding:0 16px 40px}
  .hero-heading{font-size:1.8rem}
  .hero-sub br{display:none}
  .config-row{gap:6px}
  .chip{padding:6px 10px;font-size:.75rem}
  .output-pane{padding:20px}
  .inspector-pane{padding:16px}
}

/* ============================================================
   PRINT
   ============================================================ */
@media print{
  @page{margin:1.5cm 2cm}
  body{background:#fff;color:#000}
  .compose-nav,.gen-header,.inspector-pane,.confirm-overlay,.modal,.modal-backdrop,.step-rail,.export-btn{display:none !important}
  #compose-view{display:none !important}
  #generate-view.active{height:auto;overflow:visible}
  .gen-body{display:block;height:auto;overflow:visible}
  .output-pane{
    flex:none;width:100%;
    overflow:visible;height:auto;
    padding:0;border:none;
    background:#fff;
  }
  .output-empty{display:none !important}
  .markdown-body{display:block !important}
  .markdown-body::after{display:none !important}
  .markdown-body h1,.markdown-body h2,.markdown-body h3{page-break-after:avoid}
  .markdown-body table,.markdown-body pre,.markdown-body blockquote{page-break-inside:avoid}
  .markdown-body a{text-decoration:underline;color:#000}
}

/* ============================================================
   UTILITIES
   ============================================================ */
.hidden{display:none !important}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
